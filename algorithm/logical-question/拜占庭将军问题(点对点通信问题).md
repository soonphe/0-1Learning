拜占庭将军问题（Byzantine failures），是由莱斯利·兰伯特提出的点对点通信中的基本问题。

含义是在存在消息丢失的不可靠信道上试图通过消息传递的方式达到一致性是不可能的

### 问题
拜占庭位于如今的土耳其的伊斯坦布尔，是东罗马帝国的首都。
由于当时拜占庭罗马帝国国土辽阔，为了达到防御目的，每个军队都分隔很远，将军与将军之间只能靠信差传消息。
在战争的时候，拜占庭军队内所有将军和副官必须达成一致的共识，决定是否有赢的机会才去攻打敌人的阵营。但是，在军队内有可能存有叛徒和敌军的间谍，左右将军们的决定又扰乱整体军队的秩序。
在进行共识时，结果并不代表大多数人的意见。这时候，在已知有成员谋反的情况下，其余忠诚的将军在不受叛徒的影响下如何达成一致的协议，拜占庭问题就此形成

一群将军想要实现某一个目标（一致进攻或者一致撤退），但是单独行动行不通，必须合作， 达成共识；由于叛徒的存在，将军们不知道应该如何达到一致。
注意，这里“一致性”才是拜占庭将军问题探讨的内容，如果本来叛徒数量就已经多到了问题不可解的地步，这个就是“反叛”的问题了；同时，我们的目标是忠诚的将军能够达成一致，对于这些忠诚的将军来说，进攻或者撤退都是可以的，只要他们能够达成一致就行。

问题难点
假设A和B是忠诚将军，A投进攻，B投撤退，如果C是这个叛徒将军，那么C该做些什么，才能在第二天让两个忠诚的将军做出相反的决定呢？
目前看来，进攻方和撤退方现在是 1 : 1 ，无论C投哪一方，都会变成 2 : 1 ，一致性还是会达成。但是，作为叛徒的C，你必然不会按照常规出牌，于是你让一个信使告诉A的内容是你“要进攻”，让另一个信使告诉B的则是你“要撤退”。
第二天，忠诚的A冲上了战场，却发现只有自己一支军队发起了进攻，而同样忠诚的B，却早已撤退。最终，A的军队败给了敌人。
截止目前，你有没有发现，明明大多数将军都是忠诚的（2/3），却被少数的叛徒（1/3）耍得团团转？
实质上，“拜占庭将军”问题的可怕之处，恰恰在此：在一致性达成的过程中，叛徒将军（恶意节点）甚至不需要超过半数，就可以破坏占据多数的正常节点一致性的达成。


3.2 狡猾的叛徒
这时候，会存在你可能不相信甚至无法接受的一种情况：在大多数将军都是忠诚的情况下，却无法抓出这个为所欲为的叛徒。
还是上面的例子，假设A与B是忠诚的将军，C是叛徒将军。忠诚的将军经历了上次战役的失败，就已经发觉他们中出现了叛徒，但是并不知道具体是谁。
依旧是上面投票的例子，A投进攻，B投撤退，C传递给A和B两种不同的消息。
现在，我们从忠诚将军A的视角来看一下，他是如何做决策的。
A现在知道另外两人中可能有一个是叛徒，他收到了B的撤退消息和C的进攻消息，他应该如何分辨呢？
A可以问一下B：“我从C那儿收到的是进攻，你从C那儿收到的是什么？”
因为B是忠诚的将军，不会伪造信息，B会告诉A：“收到的是撤退。”
C发送了两条不同的消息，A现在也发现了这个问题，但是A现在就可以判断C是叛徒了么？
可悲的事情发生了，尽管忠诚的B说了实话，但是A反而对他产生了怀疑。因为从A的视角来看，B和C的说法不一致，他无法判断：
到底是第一次发送了两条不同消息的C是叛徒呢?
还是明明C初次告知了B的是进攻，B却和A说C告知的是撤退，B是叛徒呢?
同样的情况，也会出现在B身上，两个忠诚的将军无法做正确的判断，而可以任意进行信息造假的叛徒C，此时只需要再次进行消息伪造：和A说“B告知我的消息是进攻”，和B说“A告知我的消息是撤退”，如此一来，就可以进一步把信息搞混，从而隐藏了自己是叛徒的真相。

综上所述，我们可以得出一个结论：在拜占庭三个将军中出现一个叛徒，并且叛徒可以任意伪造消息的情况下，只要叛徒头脑清醒，他就始终无法被发现，甚至还能造成整个系统的信任危机。

根据这一结论进一步推导可以得出一个更通用的结论，如果存在 m 个叛徒将军，那么当将军总数小于或等于 3m 时（n <= 3m，m代表叛徒将军个数)，叛徒便无法被发现，整个系统的一致性也就无法达成。

从上面的结论，可以看出，忠诚将军的人数是叛徒人数 2 倍的时候，依然不能找出叛徒，那么再多一个忠诚的将军呢？
由此可见，在多了一个忠臣的情况下，叛徒需要处处小心，才能避免被发现。与此同时，忠臣们即便在存在混乱信息的情况下，行动上也依旧达成了一致。根据推理，我们可以推导出一个结论：当忠臣的个数为 2m + 1 时，他们可以容忍 m 个叛徒产生的破坏。


**延伸点**
“拜占庭将军问题”可以进一步延伸到各个领域。
人们在互联网上进行数据交易的时候，总会习惯性依赖强大的第三方平台来进行信任担保。然而，这些解决人们信任问题的第三方正在逐渐失效，因为总有黑客能够抓住第三方平台的漏洞进行金融诈骗。
“拜占庭将军问题”中的“叛徒”就是互联网金融交易中的“骗子”，如果第三方平台出现了大漏洞或者为了规避过多的步骤将第三方信任机构撤走，“叛徒”就会利用信息在没有第三方信任机构的担保之下进行“行骗”。
在不去花费大量时间、资源揪出这个“叛徒”的情况下，能够让交易者双方都彼此信任、进行正常交易的方式就是区块

### 关于比特币的解法
在中本聪发明比特币以前，世界上并没有一个非常完美的方法来解决“拜占庭将军问题”
究其根底，“拜占庭将军问题”最终想解决的是互联网交易、合作过程中的四个问题：
（1）信息发送的身份追溯
（2）信息的私密性
（3）不可伪造的签名
（4）发送信息的规则
“拜占庭将军问题”其实就是网络世界的模型化

仅拿比特币世界来说，我们可以将每一个比特币交易账号看作一个将军，这些账号分布在世界各地，无法聚在一起，很可能会有恶意账号，账号之间的沟通也很可能因为机器坏了、网络断了、黑客攻击等受到破坏，并且有关账号是不是要支付、具体支付多少的讨论也会浪费很多时间

区块链轻而易举地解决了这一问题，它为信息发送加入了成本，降低了信息传递的速率，而且加入了一个随机元素使得在一定时间内只有一个将军可以广播信息。这里所说的成本就是区块链系统中基于随机哈希算法的“工作量证明”。哈希算法所做的事情就是计算获得的输入，得到一串64位的随机数字和字母的字符串

区块链系统计算的输入数据是指节点发送的当前时间点的整个总账。当前计算机的算力使其可以实时计算出单个哈希值，但是区块链系统只接受前13个字符是0的哈希值结果作为“工作量证明”。而前13个字符是0的哈希值是非常罕见的，需要整个网络花费10分钟的时间才在数以亿计的数据中找到一个。在一个有效的哈希值被计算出来之前，网络中已经生产了无数个无效值，这就是降低信息传递速率并使得整个系统成功运行的“工作量证明”
在拜占庭将军问题中，第一个广播信息的将军就是第一个发现有效哈希值的计算机，只要其他将军接收到并验证通过了这个有效哈希值和附着在上面的信息，他们就只能使用新的信息更新他们的总账复制，然后重新计算哈希值。下一个计算出有效哈希值的将军就可以将自己再次更新的信息附着在有效哈希值上广播给大家。然后哈希计算竞赛从一个新的开始点重新开始。由于网络信息的持续同步，所有网络上的计算机都使用着同一版本的总账
比特币区块链系统找到有效哈希值的时间间隔为10分钟，这是算法设置好的。算法难度每隔两周调整一次就是为了保证这10分钟的间隔，不能多也不能少。每隔10分钟，总账的信息就会在区块链更新并在全网同步一次。因此分散的交易记录是在所有网络上的计算机之间进行对账和同步的

因此，哈希算法对信息传递速率的限制加上加密工具使得区块链构成了一个无须信任的数据交互系统。在区块链上，一系列的交易、时间约定、域名记录、政治投票系统或者任何其他需要建立分布式协议的地方，参与者都可以达成一致


**区块链能保证消息传递的准确性**
‌主要得益于其几个核心特性：‌去中心化、‌不可篡改性、‌透明性和分布式账本。‌

去中心化：‌区块链技术通过去中心化的方式运作，‌没有单一的权威机构控制整个系统。‌这意味着信息不是由一个中心节点发布和传播，‌而是由网络中的多个节点共同维护和确认，‌从而减少了单一节点故障或被攻击的风险，‌确保了信息的真实性和可信度。‌

不可篡改性：‌区块链上的数据一旦被记录，‌就几乎无法更改。‌这是因为区块链上的每个区块都包含了前一个区块的数字指纹（‌哈希值）‌，‌如果任何区块的内容被更改，‌后续所有区块的哈希值都会发生变化，‌从而立即引起整个链条的不一致。‌这种机制保证了数据的完整性和真实性。‌

透明性：‌区块链上的数据对所有人公开，‌任何人都可以通过公开的接口查询区块链数据。‌这种透明性有助于防止信息被篡改或伪造，‌因为任何更改都会立即被其他节点发现。‌

分布式账本：‌区块链是一个分布式的账本，‌意味着所有的交易记录都被复制并存储在网络的每个节点上。‌这种分布式存储方式增加了数据的安全性和可靠性，‌因为即使部分节点出现问题，‌数据仍然可以从其他节点恢复。‌


**区块链上的数据一定不可以篡改吗**
区块链中交易数据的全网确认依靠共识算法制定的规则。所以，如果想要更改数据，就要在规则里找漏洞。目前，主流的共识算法有POW、POS、DPOS、PBFT等。

51%攻击主要发生在以POW为共识机制的加密代币中。比特币区块链系统使用的是POW（Power of Work）工作量证明共识机制，通过工作量来竞争记账权利，即多劳多得，而工作量与计算机运算能力成正比。51%攻击意味着攻击者手中掌握的算力超过该区块链网络中其他所有成员的总和，即攻击者手中掌握着51%及以上的算力。通过掌握超过51%的算力，攻击者可以抢先完成一个更长的、伪造交易的链。在比特币系统中，只认最长的链。所以，伪造的交易也会得到所有节点的认可，假的也随之变成真的了。

但是51%攻击的成本很大。全网算力按照100P计算，矿机价格按照1T/8600元计算（这是目前最低的价格），51P矿机购买费用=100P * 51% * 1024 * 8600元=449,126,400=4.5亿。攻击成本远大于收益，这也就很大程度上保证了攻击发生的可能性基本为0。但虽然51%攻击发生概率小，并不意味着不会发生。

不过，这种攻击并不是万能的。它无法修改其他人的交易记录，无法阻止其他人的交易被发出去（交易会被发出，只是显示0个确认而已），不能改变每个区块产生的比特币数量，无法凭空产生比特币，不能把不属于自己的比特币发送给自己或其他人。发起51%攻击的节点仅可以修改自己的交易记录，使他进行双重支付（同一笔钱花两次），可以阻止区块确认部分或者全部交易，也可以阻止部分或全部矿工开采到任何有效的区块。

同理，POS（Power of Stake）是权益证明共识机制。POW是算力为王，而在POS中是权益为主。POS依然是基于哈希运算竞争获取记账权的方式，容错性和POW相同，是POW的一种升级共识机制，根据每个节点所占token的比例和时间，等比例的降低挖矿难度，从而加快找随机数的速度。

简单点说，节点记账权的获得容易度与节点持有的权益成正比，节点拥有的权益越多，越容易获得记账权。与POW中的51%攻击对应，POS中攻击者需要掌握全网51%的权益（token代币）才可能造成攻击伪造数据。但是拥有全网51%的权益比获得全网51%的算力还难。

DPOS（Delegated Proof of Stake）委托权益证明共识机制，是POS的升级。DPOS中全部节点参与选举出一定数量的节点（BTS中的DPOS代表节点是101个，EOS中的DPOS代表节点是21个）代替他们进行决策。这与人民代表大会制度类似，由全部人民选举出这些数量的人民代表，各人民代表之间平等。而参与选举的人民可以随时通过投票更换这些代表。如果代表想利用权利作恶，至少要获得全部代表节点中的51%同意。

PBFT（Practical Byzantine Fault Tolerance）实用拜占庭容错算法，全网容错节点数量为（n-1）/3，n为全网节点数量。即全网达成共识需要超过2/3的节点同意。意味着如果想要做恶，就要掌握全网2/3以上节点，难度很大。

综上所述，区块链上的数据伪造、更改的成本和代价太高，所以，理性自然人不会主动发起攻击，从经济利益方面保障了区块链数据的安全。

如果创世区块（区块链的第一个数据区块）里的数据是错误的，在考虑经济成本的情况下，是无法更改的，只能将错就错，或者放弃该条链。




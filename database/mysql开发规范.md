# 0-1Learning

![alt text](../static/common/svg/luoxiaosheng.svg "公众号")
![alt text](../static/common/svg/luoxiaosheng_learning.svg "学习")
![alt text](../static/common/svg/luoxiaosheng_wechat.svg "微信")


## mysql开发规范

### 一、基础规范
1、数据库表存储引擎默认为InnnoDB，禁止使用MyISAM，特殊情况需要使用非InnoDB存储引擎须和DBA沟通（InnnoDB支持事务、行级锁、并发性能更好）
2、使用utf8mb4字符集，可以根据需求自定义为utf8(默认统一使用utf8mb4字符集，防止因为关联导致索引失效或特殊字符乱码)
3、数据表、数据字段必须加入中文注释
4、禁止使用存储过程、视图、触发器、Event、自定义函数
高并发大数据的互联网业务，架构设计思路是“解放数据库CPU，将计算转移到服务层”，并发量大的情况下，这些功能很可能将数据库拖死，业务逻辑放到服务层具备更好的扩展性，能够轻易实现“增机器就加性能”。数据库擅长存储与索引，cpu建议上移。
5、禁止使用外键约束，通过程序来控制主外键约束关系。
update与delete操作都会涉及相关联的表，十分影响sql 的性能，甚至会造成死锁。高并发情况下容易造成数据库性能瓶颈，大数据高并发业务场景数据库使用以性能优先。
6、禁止在数据库中存放图片、视频和文件等大的二进制数据（让数据库做它不擅长的事情，大文件和照片存储在文件系统，数据库里存URI多好）
7、字段设置为not null，确实需要空值的情况，可以根据实际业务，可以增加默认值规避缺值报错
8、每张表必须有主键，自增或有序且无意义，避免多列主键，尽量不选择字符串列作为主键
9、只允许使用域名，而不是ip连接数据库
10、要经常使用explain，如果发现索引选择性差，优化索引


### 二、命名规范
1、所有数据库对象命名只能包含后面的三种字符【小写字母、阿拉伯数字、下划线】，必须见名知意，禁止拼音英文混用
例：数据库名称以业务线命名，表名使用t_+"名称"形成表名，字段名使用c_+"字段名"。
2、数据库名尽量保持全公司唯一
3、所有数据库对象命名须见名知意
4、库名、表名、字段名最好别超过32个字符
5、索引命名：索引前缀 + 字段名，复合索引字段比较多时，可以简化字段名
例：唯一索引：uk_column_name  普通索引：idx_column_name
6、临时库表必须以tmp_为前缀并以日期为后缀，备份表必须以bak_为前缀并以日期(时间戳)为后缀
例如：tmp_user_info_20200806    bak_user_info_20200806
7、所有数据库对象名称禁止使用mysql保留关键字，如果包含保留关键字时，需要将其用反引号括起来
关键字详见：https://dev.mysql.com/doc/refman/5.7/en/keywords.html
8、其他研发自定义的命名规则，如表名和字段名加上相关业务的前缀等等

### 三、设计规范
1、避免使用text、blob等数据类型，在满足需求的前提下，varchar长度越小越好
2、使用tinyint代替enum、bit等类型，而后是smallint（2位），值域比较大的情况用int（4），主键建议使用bigint（8-20位）
3、使用decimal代替double、float等容易丢失精度的数据类型
4、避免使用字符串存储日期，尽量使用timestamp和datetime等日期类型
5、避免隐式转换，查询的数据类型，一定要和字段的类型匹配，相同业务数据的字段设置相同的数据类型，防止在关联查询时数据类型不匹配，发生隐式转换
6、尽量避免多表join操作
7、尽量避免索引重复，避免在低基数列上建立索引，例如“性别”
8、尽量避免在索引列进行数学运算和函数运算，如使用!=、<>、前缀%的like等造成索引失效
例：where date(create_time)='2020-08-10'  无法使用索引
可以改写为 where create_time >= '2020-08-10' and create_time < '2020-08-11'
9、单表的索引数量不建议超过5-15个，覆盖索引的字段，建议不超过5个
10、对字符串使⽤用前缀索引，前缀索引长度不超过8个字符
11、区分度最大的索引字段放在前面，核⼼SQL优先考虑覆盖索引
12、禁止存储明文密码，建议敏感信息加密
12、拒绝大事务，建议分拆成多个小事务
13、避免使用select *
14、单表数据量建议保持在500万以内，超过的数据可以做冷热数据分离或历史归档处理
15、SQL中使用到OR的改写为用IN()。OR的效率没有IN的效率高，in里面数字的个数建议控制在 50 以内
16、使用EXIST代替IN，EXIST在一些场景查询会比IN快
17、多表中的相同列，必须保证列定义一致（字符集、字段类型）
18、表必须包含记录创建时间和修改时间的字段

### 四、权限和行为规范
1、最小权限原则
默认程序用户给予select、insert、update、delete四种权限，如有特殊需求，请与DBA沟通
默认程序用户给予应用网段权限，如需要从应用网段之外访问，请与DBA沟通
每个应用程序建立独立数据库账号
禁止跨库查询
2、研发查询业务数据可通过sql审核平台来进行查询，须提前在平台申请权限
结果集条数受限于申请权限时的限制行数，如有特殊需求，可与DBA沟通调整
3、数据导出可以通过sql审核平台来操作，导出条数受限于申请权限时的限制行数
如有特殊需求，可与DBA沟通调整
4、研发对线上数据查询和操作均需通过sql审核平台
5、批量操作或者大数据量的操作，须提前与DBA沟通
6、大表的DDL操作，须提前与DBA沟通
7、单表的多个alter操作，建议合并成一个操作

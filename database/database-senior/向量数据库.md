## 向量数据库

### AIGC模型（LLM,embedding模型，向量数据库，prompt engine）

常见的数据库模型：
●第一种就是关系型数据库，其表现特征为二维表格，行和列清晰分明；

●第二个是KV数据库，它以键值对的形式存储数据，且value可以是多种类型，如字符串、数字或二进制等；

●第三种是文档型数据库，如MongoDB，它是通过一对一的映射关系来存储数据；

●第四种是图数据库，以网状结构呈现数据；

●第五个就是向量数据库，在向量数据库中，我们看到了一个三维向量的图，每个向量的数据都可以映射到这个三维坐标系上的一个点；

●最后是分析型数据库，即OLAP数据库，它通常是列存数据库，是在实际应用中使用较多的一类数据库。

### 1. 什么是向量数据库
首先，假设我们有一个数据集，里面包含一万张图片。将这些图片通过embedding算法转化成向量数据，比如1000维的向量。然后，这些向量数据会被存储到一个向量数据库中。

当数据库构建完毕后，我们如何找到与指定图片相似的图片呢？可以通过search操作来完成。例如，我指定一张图片，通过相同的embedding模型，在embedding过程中会引入领域中的大语言模型。通过大语言模型的能力，我们可以得到这张图片的向量表示，然后将其传送到向量数据库中进行检索。

在检索过程中，我们利用向量之间的相似度关系进行匹配。当我们找到匹配的图片时，可以选择返回最相似的5张图片。每张图片都有一个距离描述与指定图片的相似度。这个距离越小，说明这两张图片越相似。

### 向量数据库产品

目前市场上存在许多向量数据库产品。从国内和国外两个维度来看，国内有Milvus Manu、京东的VEARCH、蚂蚁金服的ZSearch等产品。Milvus是目前向量数据库赛道里较为热门的产品，而京东和蚂蚁更多的是将它们的应用于内部场景，外部使用较少。

在海外来看，大公司都有自己的向量数据库产品，比较知名的有如Qdrant和Weaviate等等。此外，Pinecone是目前商业向量数据库市场最热门的产品。国内的商业数据库产品有联汇和爱可生自己开发的向量数据库产品，当然这些产品都是基于开源产品进行包装的。

从三个维度来看，这些向量数据库可以分为：向量检索库、向量插件和向量字段。在检索库方面有Meta的Faiss、微软的SPTAG，谷歌的ScaNN等等。插件方面包括ES、OpenSearch和PG等产品中都集成了向量的特性。而向量字段则是数据库本身集成的向量特性，但功能相对较弱。

向量数据库
- milvus-io/milvus

向量插件
- ES:(elastiknn)
- PG:(imgsmir. CUBE, vops)

### 向量数据库的搜索原理

常用的两种搜索方式：欧氏距离和余弦相似度。

- 欧氏距离是指计算两个向量之间的直线距离。在二维坐标系中，假设有两个向量p和q，欧氏距离就是计算p到q中间连的这条直线的距离。在三维坐标系里，每一个向量包含x、y、z三个坐标点，根据公式计算任意两点之间的距离。而在n维坐标系里，有100个坐标点，根据公式计算任意两点之间的距离。距离越短，说明这两个向量在某些维度上相似性越高。

- 另一种方式是余弦相似度。除了距离，我们还可以通过向量之间的夹角来描述它们之间的关系。在二维坐标系中，如果夹角越小，说明两个向量之间的关联性越高。我们可以使用公式计算任意两个向量之间的余弦相似度。在三维坐标系里，也可以用同样的原理来计算任意两个向量之间的夹角和余弦相似度。

### 向量索引
实际上，在向量数据库中进行相似度匹配时，不能完全按照公式计算，因为向量数据库的数据量通常很大，维度也很高。

如果使用公式计算两个1000维向量之间的相似度，计算量比较大，而且对CPU的计算密集型需求很高。那如果有一亿个向量，每个都要计算一遍的话，时间和计算成本都会更加高。因此，我们此处引入了一个概念叫做向量索引。

向量索引（vector index）：是指通过某种数学模型，对向量构建的一种时间和空间上比较高效的数据结构。借助向量索引，我们能够高效地查询与目标向量相似的若干个向量

向量索引与关系数据库中的索引类似，但有一点不同。在向量数据库中，通过向量索引找到的是近似结果，而不是100%准确的结果。向量索引描述的是相似度的程度高和低。因此，我们称之为近似最邻近搜索（ANS）。如果没有向量索引的话，寻找一个向量的相似度就类似于关系数据库中的全表搜索。但是，在全表搜索之上还要多加一层的运算，因此成本比关系数据库中的全表搜索要高很多。



